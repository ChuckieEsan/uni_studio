{% extends 'common_base.html' %}
{% block stylesheet %}
<link rel="stylesheet" href="{{url_for('vote.static',filename='css/vote.css')}}" />
{% endblock %}
{% block content %}

<div class="container">
    <div class="jumbotron">
        <h2 class="display-6">{{vote_info.title}}</h2>
        <p class="lead">{{vote_info.subtitle}}</p>
        <hr class="my-4">
        <p>{{vote_info.description}}</p>
    </div>
    <form action="{{url_for('vote.vote_handler',vote_id=vote_info.id)}}" method="POST" id="voteForm">
        <div class="row">
            {% for c in candidate_all %}

            <div class="col-md-4 col-sm-12 col-xs-12">
                <div class="card" style="width: 18rem;">
                    <img src="https://wp.dutbit.com/wp20/wp-content/uploads/2020/09/cropped-%E5%B7%A5%E4%BD%9C%E5%AE%A4in-1.jpg"
                        class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">
                            {{vote_info.title_label}}:{{c.title}}-
                            {{vote_info.subtitle_label}}:{{c.subtitle}}
                        </h5>
                        <p class="card-text">
                            {{c.description[0:40]}}
                            {% if c.description|length>40 %}
                            ...
                            {% endif %}
                        </p>
                        <p class="card-text" style="font-size: smaller;">{{c.action_at}}</p>
                        <button class="btn btn-primary">查看详情</button>
                        <input type="checkbox" name="candidates" id="vote_{{c.id}}" value="{{c.id}}"
                            style="display: none;">
                        <label for="vote_{{c.id}}" class="check-btn" id="label_{{c.id}}"
                            onclick="toggleCheckedStyle('{{c.id}}')">投票</label>
                    </div>
                </div>

            </div>
            {% endfor %}

        </div>
        <div class="col-md-12 col-xs-12 col-sm-12 col-lg-12">
            <hr>

            <a name="2F"></a>
            <input type="text" name="captcha" id="captchaInput" required placeholder="验证码">
            <img class="lazy" src="{{url_for('common.static',filename='img/loading.gif')}}"
                data-original="{{url_for('common.get_captcha_img')}}" width="200px" height="50px" id="captchaImg">
            {% if voted %}
            <button type="button" class="btn btn-danger" disabled>您已投过票</button>
            {% else %}
            <button type="button" class="btn btn-primary" id="submitVote">提交</button>
            {% endif %}
        </div>

    </form>
</div>

{% endblock %}
{% block script %}
<script src="https://cdn.jsdelivr.net/npm/jquery-lazyload@1.9.7/jquery.lazyload.min.js"></script>
<script>
    // let VOTE_MIN = {
    //     {
    //         vote_info.vote_min
    //     }
    // }
    // let VOTE_MAX = {
    //     {
    //         vote_info.vote_max
    //     }
    // }
    // let STATS_URL = "{{url_for('vote.get_vote_stats',vote_id=vote_info.id)}}"
    // let SUBMIT_URL = "{{url_for('vote.vote_handler',vote_id=vote_info.id)}}" {
    //     %
    //     if voted %
    // }
    // msgFail("您已投过票！") {
    //     %
    //     endif %
    // }
    $(function () {
        $("img.lazy").lazyload({
            threshold: 200
        });
    });
</script>
{% endblock %}