{% extends 'common_base.html'%}
{% block content %}
<script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
<link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
<div class="row">
    <table class="table">
        <thead>
            <tr>
                {% for c in _class.__dict__.keys() %}
                {% if c[0]!="_" %}
                <th scope="col">{{c}}</th>
                {% endif %}
                {% endfor %}
                <th scope="col">Form</th>
            </tr>
        </thead>
        <tbody>
            {% for d in data %}
            <tr>
                {% for c in _class.__dict__.keys() %}
                {% if c[0] != '_' %}
                {% if loop.index0 == 1 %}
                <th scope="row">{{d.__dict__[c]}}</th>
                {% else %}
                <td>{{d.__dict__[c]}}</td>
                {% endif %}
                {% endif %}
                {% endfor %}
                <td>
                    <form method="POST" action="{{url_for('console.crud_put',table=_class.__tablename__)}}"
                        id="updateForm{{loop.index}}">
                        <select class="selector" name="key" form="updateForm{{loop.index}}">
                            <option value="" disabled selected>choose:</option>
                            {% for c in _class.__dict__.keys() %}
                            {% if c[0] != '_' and c != 'id' and constraints[c] %}
                            <option value="{{c}}" dtype="{{constraints[c]}}">{{c}}</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                        <input type="text" hidden name="dtype" id="dtypeInput">
                        <input type="text" hidden  name="id" value="{{d.id}}">
                        <div id="boolDiv" style="display: none;">
                            <input id="trueInput" type="radio" name="bool" value="1">
                            <label for="trueInput">True</label>
                            <input id="falseInput" type="radio" name="bool" value="0">
                            <label for="falseInput">False</label>
                        </div>
                        <div id="textDiv" style="display:none">
                            <input type="text" name="text">
                        </div>
                        <div id="datetimeDiv" style="display:none">
                            <input type="text" id="datetimeInput" name="datetime" width="234">
                        </div>
                        <input type="submit">
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
</div>
<script>
    $(".selector").change(function () {
        let dtypes = ["datetime","text","bool"]
        let dtype = this.options[this.selectedIndex].getAttribute("dtype")
        dtypes.map((v)=>{
            let node = $(`#${v}Div`)
            v===dtype?node.show():node.hide()
        })
        $("#dtypeInput").prop('value',dtype)
    })
    $('#datetimeInput').datetimepicker({
            uiLibrary: 'bootstrap4',
            modal: true,
            footer: true
        });
</script>
{% endblock %}