(this.webpackJsonphome=this.webpackJsonphome||[]).push([[0],{103:function(e,t,a){},104:function(e,t,a){},149:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(8),s=a.n(r),l=(a(103),a(68)),d=a(69),i=a(96),c=a(91),u=a(153),m=a(151),h=a(34),g=a(159),w=a(152),f=a(156),p=a(155),E=a(161),v=a(160),b=a(158),I=(a(104),a(157)),A={HOME_URL:"https://www.dutbit.com/userservice/home",USERINFO_API:"https://www.dutbit.com/userservice/v2/userinfo",MINIMAL_PASSWORD_LENGTH:3};function P(e){if(isNaN(e))return"N/A";var t=new Date(e),a=t.getFullYear(),n=t.getMonth()+1;n=n<10?"0"+n:n;var o=t.getDate();o=o<10?"0"+o:o;var r=t.getHours();r=r<10?"0"+r:r;var s=t.getMinutes(),l=t.getSeconds();return l=l<10?"0"+l:l,a+"-"+n+"-"+o+" "+r+":"+(s=s<10?"0"+s:s)}var C=function(e){Object(i.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).componentWillMount=function(){console.log("mounting"),fetch(A.USERINFO_API,{method:"GET",headers:{"Content-Type":"application/json",redirect:"follow"}}).then((function(e){return console.log(e),e.ok?e.redirected?(window.location.href=e.url,Promise.reject("Did you log in?")):e.json():Promise.reject(e.status)})).then((function(e){console.log(e);for(var t={},a=0;a<n.state.userCanAmend.length;a++)t[n.state.userCanAmend[a]]={value:e[n.state.userCanAmend[a]],disabled:!0};n.setState({userInfo:e,roles:{vol_time_admin:"\u5fd7\u613f\u65f6\u957f\u67e5\u8be2\u7ba1\u7406\u5458",super_admin:"Super Admin",default_user:"Default User"},userInfoAmend:t})})).catch((function(e){n.ErrorMsg("Error encountered: ".concat(e)),console.log("Error encountered: ".concat(e))}))},n.showModal=function(){n.setState({modalVisible:!0})},n.handleModalCancel=function(){n.setState({modalVisible:!1})},n.SuccessMsg=function(e){u.b.success(e)},n.ErrorMsg=function(e){u.b.error(e)},n.handleModalOk=function(e){for(var t={},a=0;a<n.state.userCanAmend.length;a++)"password"!==n.state.userCanAmend[a]&&(t[n.state.userCanAmend[a]]=n.state.userInfoAmend[n.state.userCanAmend[a]].value);t.old_password=n.state.oldPasswordInput,t.new_password=n.state.newPasswordInput,console.log("update result: ",t);var o,r=A.MINIMAL_PASSWORD_LENGTH;""!==t.username?(o=t.email,/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/.test(o)?""!==t.old_password&&""!==t.new_password&&(t.old_password.length<r||t.new_password.length<r)?n.ErrorMsg("Password is shorter than ".concat(r," characters")):(n.setState({modalLoading:!0}),fetch(A.USERINFO_API,{method:"PUT",headers:{"Content-Type":"application/json",redirect:"follow"},body:JSON.stringify(t)}).then((function(e){return e.redirected?(window.location.href=e.url,Promise.reject("Did you log in?")):(n.setState({modalLoading:!1}),e.ok?e.json():Promise.reject(e.status))})).then((function(e){if(console.log(e),!e.success)return Promise.reject(e.details);n.SuccessMsg(e.details),n.setState({modalVisible:!1})})).then(n.componentWillMount).catch((function(e){console.log(e),n.ErrorMsg("Error encountered: ".concat(e))})),setTimeout((function(){n.setState({modalLoading:!1,modalVisible:!1})}),2e3)):n.ErrorMsg("Invalid email address")):n.ErrorMsg("Invalid username")},n.handleAmend=function(e){var t=n.state.userInfoAmend;t[e.target.placeholder].value=e.target.value,n.setState({userInfoAmend:t})},n.handlePswChange=function(e){"new password"===e.target.placeholder?n.setState({newPasswordInput:e.target.value}):n.setState({oldPasswordInput:e.target.value})},n.togglePasswordAmend=function(e){n.setState({userPasswordAmend:!n.state.userPasswordAmend})},n.toggleDisabled=function(e,t){var a=n.state.userInfoAmend;a[e].disabled=!a[e].disabled,n.setState({userInfoAmend:a})},n.state={userCanAmend:["username","password","email"],userInfo:{},userInfoAmend:{},userPasswordAmend:!1,roles:{},modalVisible:!1,modalLoading:!1,oldPasswordInput:"",newPasswordInput:""},n}return Object(d.a)(a,[{key:"render",value:function(){var e=this,t=this.state,a=t.userInfo,n=t.roles,r=t.modalVisible,s=t.userInfoAmend,l=t.modalLoading,d=t.userPasswordAmend,i=t.oldPasswordInput,c=t.newPasswordInput,u=void 0===a.role?{}:a.role;return o.a.createElement("div",null,o.a.createElement(m.a,{title:"Edit Personal Info",visible:r,onOk:this.handleModalOk,onCancel:this.handleModalCancel,footer:[o.a.createElement(h.a,{key:"back",onClick:this.handleModalCancel},"Cancel"),o.a.createElement(h.a,{key:"submit",type:"primary",loading:l,onClick:this.handleModalOk},"Submit")]},o.a.createElement(g.b,{direction:"vertical"},Object.keys(s).map((function(t,a){return"password"!==t?o.a.createElement("div",null,o.a.createElement(w.a,{placeholder:t,addonAfter:o.a.createElement(I.a,{onClick:e.toggleDisabled.bind(e,Object.keys(s)[a])}),value:Object.values(s)[a].value,onChange:e.handleAmend,disabled:Object.values(s)[a].disabled})):d?o.a.createElement("div",null,o.a.createElement(g.b,{direction:"vertical"},o.a.createElement(w.a.Password,{placeholder:"new password",value:c,onChange:e.handlePswChange,addonAfter:o.a.createElement(b.a,{onClick:e.togglePasswordAmend})}),o.a.createElement(w.a.Password,{value:i,placeholder:"old password",iconRender:function(e){return e?o.a.createElement(E.a,null):o.a.createElement(v.a,null)},onChange:e.handlePswChange,addonAfter:o.a.createElement(b.a,{onClick:e.togglePasswordAmend})}))):o.a.createElement(w.a.Password,{placeholder:"input password",value:"*****************",addonAfter:o.a.createElement(I.a,{onClick:e.togglePasswordAmend}),iconRender:function(e){return e?o.a.createElement(E.a,null):o.a.createElement(v.a,null)},disabled:!0})})))),o.a.createElement(f.a,{title:"Personal Info",bordered:!0,column:{xxl:4,xl:3,lg:3,md:3,sm:2,xs:1},extra:o.a.createElement(I.a,{onClick:this.showModal})},o.a.createElement(f.a.Item,{label:"Username",onMouse:!0},a.username),o.a.createElement(f.a.Item,{label:"Email"},a.email),o.a.createElement(f.a.Item,{label:"Previous Login Time"},P(parseInt(a.last_login_time))),o.a.createElement(f.a.Item,{label:"Previous Update Time"},P(parseInt(a.updated_at))),o.a.createElement(f.a.Item,{label:"Validation"},a.confirmation==={}?"":JSON.stringify(a.confirmation)),o.a.createElement(f.a.Item,{label:"Previous Login Ip"},a.ip),o.a.createElement(f.a.Item,{label:"Role"},o.a.createElement("div",null,Object.keys(u).map((function(e,t){return o.a.createElement("div",{id:t},o.a.createElement(p.a,{status:"processing",text:""}),n[e])}))))))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(C,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},98:function(e,t,a){e.exports=a(149)}},[[98,1,2]]]);
//# sourceMappingURL=main.7ae43c4f.chunk.js.map